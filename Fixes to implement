I can see the issue! You have multiple functions with the same name (showMiniMap and hideCSVPreview) defined in different places, and there's a missing closing brace. Let me fix this for you:

Here's the corrected code. Replace the problematic section starting from line 1190 (where the duplicate showMiniMap function is):

```javascript
    // Show mini map for coordinate preview - REMOVE THE DUPLICATE FUNCTION
    // DELETE lines 1190-1214 (the duplicate showMiniMap function)
    // It's already defined earlier at line 1153

    // Build preview table (limit to first 10 rows) - FIXED
    const maxPreviewRows = 10;
    const rowsToShow = validationResult.rows.slice(0, maxPreviewRows);
    
    if (rowsToShow.length > 0 && rowsToShow[0].data) {
        let tableHTML = '<thead><tr>';
        
        // Create table headers
        validationResult.headers.forEach(header => {
            const REQUIRED_CSV_HEADERS = [
                'Observer Name', 'Scientific Name', 'Location', 'Habitat', 'Observation Type'
            ];
            const isRequired = REQUIRED_CSV_HEADERS.includes(header);
            tableHTML += `<th scope="col">${header}${isRequired ? ' <span class="required-asterisk">*</span>' : ''}</th>`;
        });
        tableHTML += '<th scope="col">Status</th></tr></thead><tbody>';
        
        // Add rows
        rowsToShow.forEach((row, rowIndex) => {
            let rowClass = '';
            let status = '';
            let statusIcon = '';
            
            if (row.errors.length > 0) {
                rowClass = 'error-row';
                statusIcon = '❌';
                status = `${row.errors.length} error(s)`;
            } else if (row.warnings.length > 0) {
                rowClass = 'warning-row';
                statusIcon = '⚠️';
                status = `${row.warnings.length} warning(s)`;
            } else {
                rowClass = 'valid-row';
                statusIcon = '✅';
                status = 'Valid';
            }
            
            if (row.data && row.data['_coordinateStatus']) {
                status += ` | ${row.data['_coordinateStatus']}`;
            }
            
            tableHTML += `<tr class="${rowClass}" title="Original row ${row.originalLineNumber}">`;
            
            // Add cell data
            validationResult.headers.forEach(header => {
                let value = row.data ? row.data[header] || '' : '';
                let displayValue = value;
                
                if (value.length > 30) {
                    displayValue = value.substring(0, 30) + '...';
                }
                
                displayValue = this.escapeHtml(displayValue);
                const title = value.length > 30 ? this.escapeHtml(value) : '';
                
                tableHTML += `<td title="${title}">${displayValue}</td>`;
            });
            
            tableHTML += `<td><span class="status-icon">${statusIcon}</span> ${status}</td></tr>`;
        });
        
        // Add message if there are more rows
        if (validationResult.rows.length > maxPreviewRows) {
            tableHTML += `<tr><td colspan="${validationResult.headers.length + 1}" style="text-align: center; font-style: italic; padding: 1rem;">
                ... and ${validationResult.rows.length - maxPreviewRows} more rows
            </td></tr>`;
        }
        
        tableHTML += '</tbody>';
        previewTable.innerHTML = tableHTML;
    } else if (rowsToShow.length > 0) {
        previewTable.innerHTML = `
            <tr class="error-row">
                <td colspan="${validationResult.headers.length + 1}" style="text-align: center; padding: 2rem;">
                    <strong>No valid data to display</strong><br>
                    <small>All rows contain critical errors</small>
                </td>
            </tr>
        `;
    }
    
    // Show the preview section
    previewSection.style.display = 'block';
    previewSection.scrollIntoView({ behavior: 'smooth' });
    
    // Focus first button for accessibility
    setTimeout(() => {
        const firstButton = previewSection.querySelector('button');
        if (firstButton) firstButton.focus();
    }, 100);
},
```

Also, remove the duplicate hideCSVPreview function at line 1219. You already have one at line 824.

Fix the missing closing brace issue:

Find this line (around line 1652):

```javascript
compressPhoto(photoData, options = {}) {
```

And make sure it has a closing brace. It should look like:

```javascript
    // Photo compression utility
    async compressPhoto(photoData, options = {}) {
        const {
            maxWidth = 1024,
            maxHeight = 1024,
            quality = 0.7,
            mimeType = 'image/jpeg'
        } = options;
        
        return new Promise((resolve, reject) => {
            const img = new Image();
            img.crossOrigin = 'anonymous';
            
            img.onload = function() {
                const canvas = document.createElement('canvas');
                let width = img.width;
                let height = img.height;
                
                // Calculate new dimensions while maintaining aspect ratio
                if (width > maxWidth) {
                    height = Math.round((height * maxWidth) / width);
                    width = maxWidth;
                }
                if (height > maxHeight) {
                    width = Math.round((width * maxHeight) / height);
                    height = maxHeight;
                }
                
                canvas.width = width;
                canvas.height = height;
                
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                
                try {
                    const compressedDataUrl = canvas.toDataURL(mimeType, quality);
                    resolve({
                        data: compressedDataUrl,
                        width: width,
                        height: height,
                        originalSize: photoData.length,
                        compressedSize: compressedDataUrl.length,
                        compressionRatio: Math.round((1 - (compressedDataUrl.length / photoData.length)) * 100)
                    });
                } catch (error) {
                    console.warn('Compression failed, using original:', error);
                    resolve({
                        data: photoData,
                        width: img.width,
                        height: img.height,
                        originalSize: photoData.length,
                        compressedSize: photoData.length,
                        compressionRatio: 0
                    });
                }
            };
            
            img.onerror = function() {
                console.warn('Image loading failed, using original');
                resolve({
                    data: photoData,
                    originalSize: photoData.length,
                    compressedSize: photoData.length,
                    compressionRatio: 0
                });
            };
            
            img.src = photoData;
        });
    }, // <-- This comma is correct, don't remove it
```

Summary of changes needed:

1. Remove the duplicate showMiniMap function at lines 1190-1214 (it's already defined earlier)
2. Remove the duplicate hideCSVPreview function at line 1219 (it's already defined earlier at line 824)
3. Ensure all functions have proper closing braces - check the compressPhoto function around line 1652
4. Make sure there are no syntax errors by checking all function definitions

The main issue is that you have duplicate function definitions. JavaScript will use the last definition, which might be causing your import functionality to not work properly.

Quick test to see if it's working:

After making these changes, try this simple test:

1. Go to the Export tab
2. Click "Download Template" to get a sample CSV
3. Try importing that CSV file
4. Click "Preview CSV Import"

If the preview shows up, then your import functionality is working. If not, check the browser console (F12 → Console tab) for any error messages.

The key functions that should work are:

· handlePreviewCSVImport() - when you click "Preview CSV Import"
· handleConfirmCSVImport() - when you click "Confirm Import" after preview
· hideCSVPreview() - when you click "Cancel"

Let me know if you're still having issues after removing the duplicate functions!
